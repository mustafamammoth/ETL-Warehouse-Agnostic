version: 2

sources:
  - name: repsly_raw
    description: Raw data extracted from Repsly API
    schema: repsly  # tells dbt to look in repsly schema
    tables:
      - name: raw_clients
        description: Client master data from Repsly
        columns:
          - name: ClientID
            description: Unique client identifier
          - name: TimeStamp
            description: Client timestamp for incremental updates
          - name: Code
            description: Unique client code
          - name: Name
            description: Client business name
          - name: Active
            description: Marks a client active or inactive
          - name: Tag
            description: Tags associated with this client
          - name: Territory
            description: Territory hierarchy assignment
          - name: RepresentativeCode
            description: Unique representative code
          - name: RepresentativeName
            description: Representative name
          - name: StreetAddress
            description: Client street address
          - name: ZIP
            description: Client ZIP code
          - name: ZIPExt
            description: Client ZIP extension
          - name: City
            description: Client city
          - name: State
            description: Client state
          - name: Country
            description: Client country
          - name: Email
            description: Client email address
          - name: Phone
            description: Client phone number
          - name: Mobile
            description: Client mobile phone number
          - name: Website
            description: Client website
          - name: ContactName
            description: Contact person name
          - name: ContactTitle
            description: Contact person title
          - name: Note
            description: Additional client note
          - name: Status
            description: Client status name in sales cycle
          - name: CustomFields
            description: Custom fields as JSON
          - name: PriceLists
            description: Price list names as JSON
          - name: GPSLongitude
            description: GPS longitude coordinate
          - name: GPSLatitude
            description: GPS latitude coordinate
          - name: AccountCode
            description: Code of the account assigned to this client

      - name: raw_client_notes
        description: Client notes data from Repsly
        columns:
          - name: ClientNoteID
            description: Unique client note identifier
          - name: TimeStamp
            description: Note timestamp for incremental updates
          - name: DateAndTime
            description: Microsoft JSON date format of when note was created
          - name: RepresentativeCode
            description: Code of representative who wrote the note
          - name: RepresentativeName
            description: Name of representative who wrote the note
          - name: ClientCode
            description: Client code this note belongs to
          - name: ClientName
            description: Client name this note belongs to
          - name: StreetAddress
            description: Client address at time of note
          - name: ZIP
            description: Client ZIP code
          - name: ZIPExt
            description: Client ZIP extension
          - name: City
            description: Client city
          - name: State
            description: Client state
          - name: Country
            description: Client country
          - name: Email
            description: Client email
          - name: Phone
            description: Client phone
          - name: Mobile
            description: Client mobile
          - name: Territory
            description: Territory hierarchy
          - name: Longitude
            description: GPS longitude where note was taken
          - name: Latitude
            description: GPS latitude where note was taken
          - name: Note
            description: The actual note content
          - name: VisitID
            description: ID of visit this note belongs to

      - name: raw_visits
        description: Visits data from Repsly
        columns:
          - name: VisitID
            description: Unique visit identifier
          - name: TimeStamp
            description: Visit timestamp for incremental updates
          - name: Date
            description: Planned visit date in Microsoft JSON format
          - name: RepresentativeCode
            description: Code of representative who made the visit
          - name: RepresentativeName
            description: Name of representative who made the visit
          - name: ExplicitCheckIn
            description: Whether check-in was explicit
          - name: DateAndTimeStart
            description: Actual start time of visit in Microsoft JSON format
          - name: DateAndTimeEnd
            description: Actual end time of visit in Microsoft JSON format
          - name: ClientCode
            description: Client code for the visit
          - name: ClientName
            description: Client name for the visit
          - name: StreetAddress
            description: Client address
          - name: ZIP
            description: Client ZIP code
          - name: ZIPExt
            description: Client ZIP extension
          - name: City
            description: Client city
          - name: State
            description: Client state
          - name: Country
            description: Client country
          - name: Territory
            description: Territory hierarchy
          - name: LatitudeStart
            description: GPS latitude at visit start
          - name: LongitudeStart
            description: GPS longitude at visit start
          - name: LatitudeEnd
            description: GPS latitude at visit end
          - name: LongitudeEnd
            description: GPS longitude at visit end
          - name: PrecisionStart
            description: GPS precision at visit start
          - name: PrecisionEnd
            description: GPS precision at visit end
          - name: VisitStatusBySchedule
            description: Visit status compared to schedule
          - name: VisitEnded
            description: Whether the visit was completed

      - name: raw_daily_working_time
        description: Daily working time data from Repsly
        columns:
          - name: DailyWorkingTimeID
            description: Unique daily working time identifier
          - name: Date
            description: Work date in Microsoft JSON format
          - name: DateAndTimeStart
            description: Work start time in Microsoft JSON format
          - name: DateAndTimeEnd
            description: Work end time in Microsoft JSON format
          - name: Length
            description: Total work length in minutes
          - name: MileageStart
            description: Starting mileage reading
          - name: MileageEnd
            description: Ending mileage reading
          - name: MileageTotal
            description: Total mileage for the day
          - name: LatitudeStart
            description: GPS latitude at work start
          - name: LongitudeStart
            description: GPS longitude at work start
          - name: LatitudeEnd
            description: GPS latitude at work end
          - name: LongitudeEnd
            description: GPS longitude at work end
          - name: RepresentativeCode
            description: Code of the representative
          - name: RepresentativeName
            description: Name of the representative
          - name: Note
            description: Work day notes
          - name: Tag
            description: Tags for the work day
          - name: NoOfVisits
            description: Number of visits made
          - name: MinOfVisits
            description: Minimum time for visits
          - name: MaxOfVisits
            description: Maximum time for visits
          - name: MinMaxVisitsTime
            description: Min/max visit time range
          - name: TimeAtClient
            description: Time spent at client locations in minutes
          - name: TimeInTravel
            description: Time spent traveling in minutes
          - name: TimeInPause
            description: Time spent in pause/break in minutes

      - name: raw_users
        description: Users/representatives data from Repsly
        columns:
          - name: ID
            description: Unique user identifier (GUID)
          - name: Code
            description: User code
          - name: Name
            description: User full name
          - name: Email
            description: User email address
          - name: Active
            description: Whether user is active
          - name: Role
            description: User role(s) - can be multiple separated by |
          - name: Note
            description: Additional user notes
          - name: Phone
            description: User phone number
          - name: Territories
            description: Territory assignments as JSON
          - name: SendEmailEnabled
            description: Whether user can send emails
          - name: Address1
            description: Primary address line
          - name: Address2
            description: Secondary address line
          - name: City
            description: User city
          - name: State
            description: User state
          - name: ZipCode
            description: User ZIP code
          - name: ZipCodeExt
            description: ZIP code extension
          - name: Country
            description: User country
          - name: CountryCode
            description: Country code
          - name: Attributes
            description: User attributes as JSON
          - name: Permissions
            description: User permissions as JSON
          - name: Teams
            description: Team assignments as JSON
          - name: ShowActivitiesWithoutTeam
            description: Whether to show activities without team assignment

models:
  - name: clients_raw
    description: Raw client data with basic filtering and renaming
    columns:
      - name: client_id
        description: Clean client ID
        tests:
          - not_null
          - unique
      - name: code
        description: Unique client code
        tests:
          - not_null
      - name: name
        description: Client business name
        tests:
          - not_null
      - name: active_raw
        description: Raw active flag as text
      - name: representative_code
        description: Representative code
      - name: representative_name
        description: Representative name
      - name: email
        description: Client email address
      - name: phone
        description: Client phone number
      - name: gps_longitude_raw
        description: Raw GPS longitude as text
      - name: gps_latitude_raw
        description: Raw GPS latitude as text

  - name: clients
    description: Cleaned and enhanced client data
    columns:
      - name: client_id
        description: Clean client identifier
        tests:
          - not_null
          - unique
      - name: code
        description: Unique client code
        tests:
          - not_null
          - unique
      - name: name
        description: Cleaned client name
        tests:
          - not_null
      - name: is_active
        description: Active status as boolean
        tests:
          - not_null
      - name: representative_code
        description: Representative code
      - name: representative_name
        description: Representative name
      - name: full_address
        description: Concatenated full address
      - name: email_clean
        description: Cleaned and validated email
      - name: phone_clean
        description: Cleaned phone number
      - name: gps_longitude
        description: GPS longitude as decimal
      - name: gps_latitude
        description: GPS latitude as decimal
      - name: client_tier
        description: Client tier classification
        tests:
          - accepted_values:
              values: ['Enterprise', 'Premium', 'Standard', 'Basic', 'Unknown']
      - name: territory_level_1
        description: Top level territory
      - name: territory_level_2
        description: Second level territory
      - name: address_quality
        description: Address completeness assessment
        tests:
          - accepted_values:
              values: ['Complete', 'Partial', 'Minimal', 'Missing']
      - name: contact_quality
        description: Contact information quality
        tests:
          - accepted_values:
              values: ['Excellent', 'Good', 'Fair', 'Poor']
      - name: data_quality_flag
        description: Overall data quality assessment
        tests:
          - accepted_values:
              values: ['High Quality', 'Good Quality', 'Needs Improvement', 'Poor Quality']

  - name: client_notes_raw
    description: Raw client notes data with basic filtering and renaming
    columns:
      - name: client_note_id
        description: Clean client note ID
        tests:
          - not_null
          - unique
      - name: client_code
        description: Client code this note belongs to
        tests:
          - not_null
      - name: representative_code
        description: Representative code who wrote the note
      - name: representative_name
        description: Representative name who wrote the note
      - name: note
        description: The actual note content
      - name: visit_id
        description: Associated visit ID
      - name: date_and_time_raw
        description: Raw Microsoft JSON date format

  - name: client_notes
    description: Cleaned and enhanced client notes data
    columns:
      - name: client_note_id
        description: Clean client note identifier
        tests:
          - not_null
          - unique
      - name: client_code
        description: Client code this note belongs to
        tests:
          - not_null
      - name: representative_code
        description: Representative code who wrote the note
      - name: representative_name
        description: Representative name who wrote the note
      - name: note_cleaned
        description: Cleaned note content
      - name: note_datetime
        description: Parsed datetime when note was created
        tests:
          - not_null
      - name: note_date
        description: Date when note was created
        tests:
          - not_null
      - name: note_category
        description: Categorized note type
        tests:
          - accepted_values:
              values: ['Inventory Issue', 'Ordering', 'Promotion', 'Display/Demo', 'Staff Interaction', 'Availability', 'Training', 'Product Discussion', 'General']
      - name: note_sentiment
        description: Basic sentiment analysis
        tests:
          - accepted_values:
              values: ['Positive', 'Negative', 'Neutral']
      - name: business_priority
        description: Business priority level
        tests:
          - accepted_values:
              values: ['High', 'Medium', 'Low']
      - name: note_quality
        description: Note quality assessment
        tests:
          - accepted_values:
              values: ['Detailed', 'Adequate', 'Brief', 'Minimal', 'Empty']
      - name: time_of_day
        description: Time of day categorization
        tests:
          - accepted_values:
              values: ['Morning', 'Afternoon', 'Evening', 'Other']
      - name: day_of_week_name
        description: Day of week when note was written
      - name: territory_level_1
        description: Top level territory
      - name: territory_level_2
        description: Second level territory
      - name: state_standardized
        description: Standardized state name
      - name: note_length
        description: Length of note in characters
      - name: data_completeness_score
        description: Data completeness score (0-100)

  - name: daily_working_time_raw
    description: Raw daily working time data with basic filtering and renaming
    columns:
      - name: daily_working_time_id
        description: Clean daily working time ID
        tests:
          - not_null
          - unique
      - name: representative_code
        description: Representative code
        tests:
          - not_null
      - name: representative_name
        description: Representative name
      - name: date_raw
        description: Raw work date in Microsoft JSON format
      - name: date_and_time_start_raw
        description: Raw start time in Microsoft JSON format
      - name: date_and_time_end_raw
        description: Raw end time in Microsoft JSON format
      - name: length_raw
        description: Raw work length as text
      - name: mileage_total_raw
        description: Raw total mileage as text
      - name: no_of_visits_raw
        description: Raw number of visits as text

  - name: daily_working_time
    description: Cleaned and enhanced daily working time data
    columns:
      - name: daily_working_time_id
        description: Clean daily working time identifier
        tests:
          - not_null
          - unique
      - name: representative_code
        description: Representative code
        tests:
          - not_null
      - name: representative_name
        description: Representative name
        tests:
          - not_null
      - name: work_date
        description: Date of work
        tests:
          - not_null
      - name: work_start_datetime
        description: Work start datetime
      - name: work_end_datetime
        description: Work end datetime
      - name: actual_work_duration_minutes
        description: Actual work duration in minutes
      - name: number_of_visits
        description: Number of client visits made
      - name: time_at_client_minutes
        description: Time spent at client locations in minutes
      - name: time_in_travel_minutes
        description: Time spent traveling in minutes
      - name: time_in_pause_minutes
        description: Time spent in pause/break in minutes
      - name: mileage_total
        description: Total mileage for the day
      - name: client_time_percentage
        description: Percentage of work time spent with clients
      - name: travel_time_percentage
        description: Percentage of work time spent traveling
      - name: work_duration_category
        description: Categorized work duration
        tests:
          - accepted_values:
              values: ['No Work Time', 'Very Short (<1 hour)', 'Short (1-4 hours)', 'Standard (4-8 hours)', 'Long (8-10 hours)', 'Very Long (10+ hours)']
      - name: start_time_category
        description: Categorized start time
        tests:
          - accepted_values:
              values: ['Unknown Start', 'Early Start (5-8 AM)', 'Morning Start (9-11 AM)', 'Afternoon Start (12-2 PM)', 'Late Start (3-5 PM)', 'Other Start Time']
      - name: visit_productivity_category
        description: Categorized visit productivity
        tests:
          - accepted_values:
              values: ['No Visits', 'Single Visit', 'Few Visits (2-3)', 'Multiple Visits (4-6)', 'Many Visits (7+)']
      - name: efficiency_rating
        description: Work efficiency rating
        tests:
          - accepted_values:
              values: ['High Efficiency', 'Good Efficiency', 'Moderate Efficiency', 'Low Efficiency', 'No Client Time']
      - name: mileage_category
        description: Categorized mileage
        tests:
          - accepted_values:
              values: ['No Mileage', 'Low Mileage (<50)', 'Medium Mileage (50-150)', 'High Mileage (150-300)', 'Very High Mileage (300+)']
      - name: work_day_type
        description: Type of work day
        tests:
          - accepted_values:
              values: ['Weekday', 'Weekend', 'Unknown']
      - name: day_of_week_name
        description: Day of week when work occurred
      - name: work_completion_status
        description: Whether work day was completed
        tests:
          - accepted_values:
              values: ['Ongoing/Incomplete', 'Completed', 'Unknown']
      - name: gps_data_quality
        description: GPS data completeness
        tests:
          - accepted_values:
              values: ['Complete GPS', 'Partial GPS (Start Only)', 'Partial GPS (End Only)', 'No GPS']
      - name: minutes_per_visit
        description: Average minutes per visit
      - name: mileage_per_visit
        description: Average mileage per visit
      - name: data_completeness_score
        description: Data completeness score (0-100)

  - name: users_raw
    description: Raw users data with basic filtering and renaming
    columns:
      - name: user_id
        description: Clean user ID (GUID)
        tests:
          - not_null
          - unique
      - name: code
        description: User code
      - name: name
        description: User full name
        tests:
          - not_null
      - name: email
        description: User email address
      - name: active_raw
        description: Raw active flag as text
      - name: role_raw
        description: Raw role information
      - name: phone
        description: User phone number
      - name: territories_json
        description: Territory assignments as JSON
      - name: permissions_json
        description: User permissions as JSON

  - name: users
    description: Cleaned and enhanced users data
    columns:
      - name: user_id
        description: Clean user identifier (GUID)
        tests:
          - not_null
          - unique
      - name: code
        description: User code
      - name: name
        description: User full name
        tests:
          - not_null
      - name: email_clean
        description: Cleaned and validated email
      - name: phone_clean
        description: Cleaned phone number
      - name: is_active
        description: Active status as boolean
        tests:
          - not_null
      - name: primary_role
        description: Primary user role
        tests:
          - accepted_values:
              values: ['Admin', 'Representative', '']
      - name: user_type
        description: User type classification
        tests:
          - accepted_values:
              values: ['Admin Representative', 'Admin Only', 'Representative Only', 'Other']
      - name: user_status
        description: User status classification
        tests:
          - accepted_values:
              values: ['Active', 'Inactive', 'Active - No Email', 'Deactivated Account', 'Unknown Status']
      - name: company_affiliation
        description: Company affiliation based on email domain
        tests:
          - accepted_values:
              values: ['Mammoth Distribution', 'Repsly (External)', 'Test Account', 'External', 'Unknown']
      - name: is_admin
        description: Whether user has admin role
        tests:
          - not_null
      - name: is_representative
        description: Whether user has representative role
        tests:
          - not_null
      - name: is_test_account
        description: Whether this is a test account
        tests:
          - not_null
      - name: address_quality
        description: Address completeness assessment
        tests:
          - accepted_values:
              values: ['Complete', 'Partial', 'Minimal', 'Missing']
      - name: contact_quality
        description: Contact information quality
        tests:
          - accepted_values:
              values: ['Excellent', 'Good', 'Email Only', 'Phone Only', 'Poor']
      - name: permission_level
        description: Permission level assessment
        tests:
          - accepted_values:
              values: ['No Permissions', 'Full Permissions', 'Limited Permissions', 'Basic Permissions']
      - name: territory_scope
        description: Territory assignment scope
        tests:
          - accepted_values:
              values: ['All Territories', 'Specific Territories', 'No Territory Assignment']
      - name: access_level
        description: Security access level
        tests:
          - accepted_values:
              values: ['High Access', 'Admin Access', 'Field Access', 'Limited Access']
      - name: email_domain
        description: Email domain for company analysis
      - name: first_name
        description: Parsed first name
      - name: last_name
        description: Parsed last name
      - name: full_address
        description: Concatenated full address
      - name: data_completeness_score
        description: Data completeness score (0-100)